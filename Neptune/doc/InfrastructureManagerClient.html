<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class InfrastructureManagerClient - RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>Neptune/lib/infrastructure_manager_client.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="Object.html">Object</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-describe_instances">#describe_instances</a>
    
    <li><a href="#method-i-make_call">#make_call</a>
    
    <li><a href="#method-i-run_instances">#run_instances</a>
    
    <li><a href="#method-i-spawn_vms">#spawn_vms</a>
    
    <li><a href="#method-i-terminate_instances">#terminate_instances</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./AppControllerClient.html">AppControllerClient</a>
  
    <li><a href="./BadConfigurationException.html">BadConfigurationException</a>
  
    <li><a href="./Datastore.html">Datastore</a>
  
    <li><a href="./DatastoreFactory.html">DatastoreFactory</a>
  
    <li><a href="./DatastoreRepo.html">DatastoreRepo</a>
  
    <li><a href="./DatastoreRepoOnAppEngine.html">DatastoreRepoOnAppEngine</a>
  
    <li><a href="./DatastoreRepoOnAppScale.html">DatastoreRepoOnAppScale</a>
  
    <li><a href="./DatastoreS3.html">DatastoreS3</a>
  
    <li><a href="./DatastoreWAZStorage.html">DatastoreWAZStorage</a>
  
    <li><a href="./DjinnJobData.html">DjinnJobData</a>
  
    <li><a href="./EngineFactory.html">EngineFactory</a>
  
    <li><a href="./FailedZooKeeperOperationException.html">FailedZooKeeperOperationException</a>
  
    <li><a href="./GoogleAppEnginePullQueue.html">GoogleAppEnginePullQueue</a>
  
    <li><a href="./GoogleAppEnginePushQueue.html">GoogleAppEnginePushQueue</a>
  
    <li><a href="./HelperFunctions.html">HelperFunctions</a>
  
    <li><a href="./InfrastructureManagerClient.html">InfrastructureManagerClient</a>
  
    <li><a href="./JSONClient.html">JSONClient</a>
  
    <li><a href="./NeptuneJobData.html">NeptuneJobData</a>
  
    <li><a href="./NeptuneManager.html">NeptuneManager</a>
  
    <li><a href="./NeptuneManagerClient.html">NeptuneManagerClient</a>
  
    <li><a href="./NeptuneManagerServer.html">NeptuneManagerServer</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./QueueFactory.html">QueueFactory</a>
  
    <li><a href="./TaskEngine.html">TaskEngine</a>
  
    <li><a href="./TaskEngineAppScale.html">TaskEngineAppScale</a>
  
    <li><a href="./TaskEngineGoogleAppEngine.html">TaskEngineGoogleAppEngine</a>
  
    <li><a href="./TaskQueue.html">TaskQueue</a>
  
    <li><a href="./TaskQueueAzureQueue.html">TaskQueueAzureQueue</a>
  
    <li><a href="./TaskQueueGoogleAppEngine.html">TaskQueueGoogleAppEngine</a>
  
    <li><a href="./TaskQueueRabbitMQ.html">TaskQueueRabbitMQ</a>
  
    <li><a href="./TaskQueueSQS.html">TaskQueueSQS</a>
  
    <li><a href="./UserAppClient.html">UserAppClient</a>
  
    <li><a href="./ZKInterface.html">ZKInterface</a>
  
    <li><a href="./ZooKeeperLockException.html">ZooKeeperLockException</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class InfrastructureManagerClient</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="ABORT_ON_FAIL">ABORT_ON_FAIL
        
        <dd class="description"><p>A constant that callers can use to indicate that SOAP calls should not be
retried if they fail.</p>
        
      
        <dt id="NO_TIMEOUT">NO_TIMEOUT
        
        <dd class="description"><p>A constant that indicates that there should be no timeout on SOAP calls.</p>
        
      
        <dt id="RETRY_ON_FAIL">RETRY_ON_FAIL
        
        <dd class="description"><p>A constant that callers can use to indicate that SOAP calls should be
retried if they fail (e.g., if the connection was refused).</p>
        
      
        <dt id="SERVER_PORT">SERVER_PORT
        
        <dd class="description"><p>The port that the InfrastructureManager runs on, by default.</p>
        
      
      </dl>
    </section>
    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-conn" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">conn</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>The SOAP client that we use to communicate with the InfrastructureManager.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-secret" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">secret</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>The secret string that is used to authenticate this client with
InfrastructureManagers. It is initially generated by 
appscale-run-instances and can be found on the machine that ran that tool,
or on any AppScale machine.</p>
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(secret)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File Neptune/lib/infrastructure_manager_client.rb, line 48</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">secret</span>)
  <span class="ruby-identifier">ip</span> = <span class="ruby-constant">HelperFunctions</span>.<span class="ruby-identifier">local_ip</span>()
  <span class="ruby-ivar">@secret</span> = <span class="ruby-identifier">secret</span>
  
  <span class="ruby-ivar">@conn</span> = <span class="ruby-constant">SOAP</span><span class="ruby-operator">::</span><span class="ruby-constant">RPC</span><span class="ruby-operator">::</span><span class="ruby-constant">Driver</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;https://#{ip}:#{SERVER_PORT}&quot;</span>)
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">add_method</span>(<span class="ruby-string">&quot;get_queues_in_use&quot;</span>, <span class="ruby-string">&quot;secret&quot;</span>)
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">add_method</span>(<span class="ruby-string">&quot;run_instances&quot;</span>, <span class="ruby-string">&quot;parameters&quot;</span>, <span class="ruby-string">&quot;secret&quot;</span>)
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">add_method</span>(<span class="ruby-string">&quot;describe_instances&quot;</span>, <span class="ruby-string">&quot;parameters&quot;</span>, <span class="ruby-string">&quot;secret&quot;</span>)
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">add_method</span>(<span class="ruby-string">&quot;terminate_instances&quot;</span>, <span class="ruby-string">&quot;parameters&quot;</span>, <span class="ruby-string">&quot;secret&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-describe_instances" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">describe_instances</span><span
            class="method-args">(parameters)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="describe_instances-source">
            <pre><span class="ruby-comment"># File Neptune/lib/infrastructure_manager_client.rb, line 131</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">describe_instances</span>(<span class="ruby-identifier">parameters</span>)
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Calling describe_instances with parameters &quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-node">&quot;#{parameters.inspect}&quot;</span>)

  <span class="ruby-identifier">make_call</span>(<span class="ruby-constant">NO_TIMEOUT</span>, <span class="ruby-constant">RETRY_ON_FAIL</span>, <span class="ruby-string">&quot;describe_instances&quot;</span>) { 
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">describe_instances</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-ivar">@secret</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- describe_instances-source -->
          
        </div>

        

        
      </div><!-- describe_instances-method -->

    
      <div id="method-i-make_call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_call</span><span
            class="method-args">(time, retry_on_except, callr, ok_to_fail=false) { || ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>A helper method that makes SOAP calls for us. This method is mainly here to
reduce code duplication: all SOAP calls expect a certain timeout and can
tolerate certain exceptions, so we consolidate this code into this method.
Here, the caller specifies the timeout for the SOAP call (or <a
href="InfrastructureManagerClient.html#NO_TIMEOUT">NO_TIMEOUT</a> if an
infinite timeout is required) as well as whether the call should be retried
in the face of exceptions. Exceptions can occur if the machine is not yet
running or is too busy to handle the request, so these exceptions are
automatically retried regardless of the retry value. Typically callers set
this to false to catch ‘Connection Refused’ exceptions or the like.
Finally, the caller must provide a block of code that indicates the SOAP
call to make: this is really all that differs between the calling methods.
The result of the block is returned to the caller.</p>
          

          
          <div class="method-source-code" id="make_call-source">
            <pre><span class="ruby-comment"># File Neptune/lib/infrastructure_manager_client.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">make_call</span>(<span class="ruby-identifier">time</span>, <span class="ruby-identifier">retry_on_except</span>, <span class="ruby-identifier">callr</span>, <span class="ruby-identifier">ok_to_fail</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">refused_count</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">max</span> = <span class="ruby-value">5</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-identifier">timeout</span>(<span class="ruby-identifier">time</span>) {
      <span class="ruby-keyword">yield</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
    }
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNREFUSED</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EHOSTUNREACH</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">except</span>
    <span class="ruby-identifier">trace</span> = <span class="ruby-identifier">except</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Saw an Exception of class #{except.class}, with &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;trace: #{trace}&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">refused_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ok_to_fail</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;Connection was refused. Is the &quot;</span> <span class="ruby-operator">+</span>
        <span class="ruby-string">&quot;AppController running?&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">refused_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">1</span>)
      <span class="ruby-keyword">retry</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Saw a Timeout Error&quot;</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ok_to_fail</span>
    <span class="ruby-keyword">retry</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLError</span>, <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EPIPE</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNRESET</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">except</span>
    <span class="ruby-identifier">trace</span> = <span class="ruby-identifier">except</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Saw an Exception of class #{except.class}, with &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;trace: #{trace}&quot;</span>)
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">1</span>)
    <span class="ruby-keyword">retry</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">except</span>
    <span class="ruby-identifier">trace</span> = <span class="ruby-identifier">except</span>.<span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Saw an Exception of class #{except.class}, with &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;trace: #{trace}&quot;</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">retry_on_except</span>
      <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">1</span>)
      <span class="ruby-keyword">retry</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">AppScaleException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;[#{callr}] We saw an unexpected error &quot;</span> <span class="ruby-operator">+</span>
        <span class="ruby-node">&quot;of the type #{except.class} with the following message:\n&quot;</span> <span class="ruby-operator">+</span>
        <span class="ruby-node">&quot;#{except}. Trace is #{trace}&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- make_call-source -->
          
        </div>

        

        
      </div><!-- make_call-method -->

    
      <div id="method-i-run_instances" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_instances</span><span
            class="method-args">(parameters)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="run_instances-source">
            <pre><span class="ruby-comment"># File Neptune/lib/infrastructure_manager_client.rb, line 121</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">run_instances</span>(<span class="ruby-identifier">parameters</span>)
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Calling run_instances with parameters &quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-node">&quot;#{parameters.inspect}&quot;</span>)

  <span class="ruby-identifier">make_call</span>(<span class="ruby-constant">NO_TIMEOUT</span>, <span class="ruby-constant">RETRY_ON_FAIL</span>, <span class="ruby-string">&quot;run_instances&quot;</span>) { 
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">run_instances</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-ivar">@secret</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- run_instances-source -->
          
        </div>

        

        
      </div><!-- run_instances-method -->

    
      <div id="method-i-spawn_vms" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">spawn_vms</span><span
            class="method-args">(num_vms, creds, job, cloud)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="spawn_vms-source">
            <pre><span class="ruby-comment"># File Neptune/lib/infrastructure_manager_client.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">spawn_vms</span>(<span class="ruby-identifier">num_vms</span>, <span class="ruby-identifier">creds</span>, <span class="ruby-identifier">job</span>, <span class="ruby-identifier">cloud</span>)
  <span class="ruby-identifier">credentials</span> = {
    <span class="ruby-string">'EC2_ACCESS_KEY'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creds</span>[<span class="ruby-string">'ec2_access_key'</span>],
    <span class="ruby-string">'EC2_SECRET_KEY'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creds</span>[<span class="ruby-string">'ec2_secret_key'</span>],
    <span class="ruby-string">'EC2_URL'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creds</span>[<span class="ruby-string">'ec2_url'</span>]
  }

  <span class="ruby-identifier">run_result</span> = <span class="ruby-identifier">run_instances</span>(<span class="ruby-string">&quot;credentials&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">credentials</span>,
    <span class="ruby-string">&quot;group&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creds</span>[<span class="ruby-string">'group'</span>], 
    <span class="ruby-string">&quot;image_id&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creds</span>[<span class="ruby-string">'machine'</span>],
    <span class="ruby-string">&quot;infrastructure&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creds</span>[<span class="ruby-string">'infrastructure'</span>],
    <span class="ruby-string">&quot;instance_type&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creds</span>[<span class="ruby-string">'instance_type'</span>],
    <span class="ruby-string">&quot;keyname&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creds</span>[<span class="ruby-string">'keyname'</span>],
    <span class="ruby-string">&quot;num_vms&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{num_vms}&quot;</span>,
    <span class="ruby-string">&quot;cloud&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cloud</span>,
    <span class="ruby-string">&quot;spot&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;false&quot;</span>)
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;[IM] Run instances info says [#{run_result}]&quot;</span>)
  <span class="ruby-identifier">reservation_id</span> = <span class="ruby-identifier">run_result</span>[<span class="ruby-string">'reservation_id'</span>]

  <span class="ruby-identifier">vm_info</span> = {}
  <span class="ruby-identifier">loop</span> {
    <span class="ruby-identifier">describe_result</span> = <span class="ruby-identifier">describe_instances</span>(<span class="ruby-string">&quot;reservation_id&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">reservation_id</span>)
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;[IM] Describe instances info says [#{describe_result}]&quot;</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">describe_result</span>[<span class="ruby-string">&quot;state&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;running&quot;</span>
      <span class="ruby-identifier">vm_info</span> = <span class="ruby-identifier">describe_result</span>[<span class="ruby-string">&quot;vm_info&quot;</span>]
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-value">10</span>)
  }

  <span class="ruby-comment"># now, turn this info back into the format we normally use</span>
  <span class="ruby-identifier">jobs</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">job</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
    <span class="ruby-comment"># We only got one job, so just repeat it for each one of the nodes</span>
    <span class="ruby-identifier">vm_info</span>[<span class="ruby-string">'public_ips'</span>].<span class="ruby-identifier">length</span>.<span class="ruby-identifier">times</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">jobs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">job</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">jobs</span> = <span class="ruby-identifier">job</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment"># ip:job:instance-id</span>
  <span class="ruby-identifier">instances_created</span> = []
  <span class="ruby-identifier">vm_info</span>[<span class="ruby-string">'public_ips'</span>].<span class="ruby-identifier">each_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">instances_created</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{vm_info['public_ips'][index]}:#{vm_info['private_ips'][index]}:#{jobs[index]}:#{vm_info['instance_ids'][index]}:#{cloud}&quot;</span>
  }

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">instances_created</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- spawn_vms-source -->
          
        </div>

        

        
      </div><!-- spawn_vms-method -->

    
      <div id="method-i-terminate_instances" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">terminate_instances</span><span
            class="method-args">(parameters)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="terminate_instances-source">
            <pre><span class="ruby-comment"># File Neptune/lib/infrastructure_manager_client.rb, line 141</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">terminate_instances</span>(<span class="ruby-identifier">parameters</span>)
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Calling terminate_instances with parameters &quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-node">&quot;#{parameters.inspect}&quot;</span>)

  <span class="ruby-identifier">make_call</span>(<span class="ruby-constant">NO_TIMEOUT</span>, <span class="ruby-constant">RETRY_ON_FAIL</span>, <span class="ruby-string">&quot;terminate_instances&quot;</span>) { 
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">terminate_instances</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-ivar">@secret</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- terminate_instances-source -->
          
        </div>

        

        
      </div><!-- terminate_instances-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

