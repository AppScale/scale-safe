<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>module HelperFunctions - RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="module">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>Neptune/lib/helperfunctions.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-get_cert">::get_cert</a>
    
    <li><a href="#method-c-get_cloud_info">::get_cloud_info</a>
    
    <li><a href="#method-c-get_key">::get_key</a>
    
    <li><a href="#method-c-get_my_public_ip">::get_my_public_ip</a>
    
    <li><a href="#method-c-get_random_alphanumeric">::get_random_alphanumeric</a>
    
    <li><a href="#method-c-get_secret">::get_secret</a>
    
    <li><a href="#method-c-is_port_open-3F">::is_port_open?</a>
    
    <li><a href="#method-c-local_ip">::local_ip</a>
    
    <li><a href="#method-c-read_file">::read_file</a>
    
    <li><a href="#method-c-read_json_file">::read_json_file</a>
    
    <li><a href="#method-c-run_remote_command">::run_remote_command</a>
    
    <li><a href="#method-c-scp_file">::scp_file</a>
    
    <li><a href="#method-c-shell">::shell</a>
    
    <li><a href="#method-c-sleep_until_port_is_open">::sleep_until_port_is_open</a>
    
    <li><a href="#method-c-write_file">::write_file</a>
    
    <li><a href="#method-c-write_json_file">::write_json_file</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./AppControllerClient.html">AppControllerClient</a>
  
    <li><a href="./BadConfigurationException.html">BadConfigurationException</a>
  
    <li><a href="./Datastore.html">Datastore</a>
  
    <li><a href="./DatastoreFactory.html">DatastoreFactory</a>
  
    <li><a href="./DatastoreRepo.html">DatastoreRepo</a>
  
    <li><a href="./DatastoreRepoOnAppEngine.html">DatastoreRepoOnAppEngine</a>
  
    <li><a href="./DatastoreRepoOnAppScale.html">DatastoreRepoOnAppScale</a>
  
    <li><a href="./DatastoreS3.html">DatastoreS3</a>
  
    <li><a href="./DatastoreWAZStorage.html">DatastoreWAZStorage</a>
  
    <li><a href="./DjinnJobData.html">DjinnJobData</a>
  
    <li><a href="./EngineFactory.html">EngineFactory</a>
  
    <li><a href="./FailedZooKeeperOperationException.html">FailedZooKeeperOperationException</a>
  
    <li><a href="./GoogleAppEnginePullQueue.html">GoogleAppEnginePullQueue</a>
  
    <li><a href="./GoogleAppEnginePushQueue.html">GoogleAppEnginePushQueue</a>
  
    <li><a href="./HelperFunctions.html">HelperFunctions</a>
  
    <li><a href="./InfrastructureManagerClient.html">InfrastructureManagerClient</a>
  
    <li><a href="./JSONClient.html">JSONClient</a>
  
    <li><a href="./NeptuneJobData.html">NeptuneJobData</a>
  
    <li><a href="./NeptuneManager.html">NeptuneManager</a>
  
    <li><a href="./NeptuneManagerClient.html">NeptuneManagerClient</a>
  
    <li><a href="./NeptuneManagerServer.html">NeptuneManagerServer</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./QueueFactory.html">QueueFactory</a>
  
    <li><a href="./TaskEngine.html">TaskEngine</a>
  
    <li><a href="./TaskEngineAppScale.html">TaskEngineAppScale</a>
  
    <li><a href="./TaskEngineGoogleAppEngine.html">TaskEngineGoogleAppEngine</a>
  
    <li><a href="./TaskQueue.html">TaskQueue</a>
  
    <li><a href="./TaskQueueAzureQueue.html">TaskQueueAzureQueue</a>
  
    <li><a href="./TaskQueueGoogleAppEngine.html">TaskQueueGoogleAppEngine</a>
  
    <li><a href="./TaskQueueRabbitMQ.html">TaskQueueRabbitMQ</a>
  
    <li><a href="./TaskQueueSQS.html">TaskQueueSQS</a>
  
    <li><a href="./UserAppClient.html">UserAppClient</a>
  
    <li><a href="./ZKInterface.html">ZKInterface</a>
  
    <li><a href="./ZooKeeperLockException.html">ZooKeeperLockException</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="module">module HelperFunctions</h1>

  <div id="description" class="description">
    
<p><a href="HelperFunctions.html">HelperFunctions</a> holds miscellaneous
functions - functions that really aren’t bound to a particular service,
but are reused across multiple functions. TODO(cgb): Consider removing App
Engine-related functions below into its own helper class</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="APPSCALE_HOME">APPSCALE_HOME
        
        <dd class="description">
        
      
        <dt id="APP_START_PORT">APP_START_PORT
        
        <dd class="description"><p>The first port that should be used to host Google App Engine applications
that users have uploaded.</p>
        
      
        <dt id="CLOUDY_CREDS">CLOUDY_CREDS
        
        <dd class="description">
        
      
        <dt id="CLOUD_INFO_FILE">CLOUD_INFO_FILE
        
        <dd class="description">
        
      
        <dt id="DEFAULT_SKIP_FILES_REGEX">DEFAULT_SKIP_FILES_REGEX
        
        <dd class="description">
        
      
        <dt id="DELTA_REGEX">DELTA_REGEX
        
        <dd class="description">
        
      
        <dt id="DONT_USE_SSL">DONT_USE_SSL
        
        <dd class="description"><p>A constant that indicates that SSL should not be used when checking if a
given port is open.</p>
        
      
        <dt id="FQDN_REGEX">FQDN_REGEX
        
        <dd class="description">
        
      
        <dt id="IP_OR_FQDN">IP_OR_FQDN
        
        <dd class="description">
        
      
        <dt id="IP_REGEX">IP_REGEX
        
        <dd class="description">
        
      
        <dt id="MAX_VM_CREATION_TIME">MAX_VM_CREATION_TIME
        
        <dd class="description"><p>The maximum amount of time, in seconds, that we are willing to wait for a
virtual machine to start up, from the initial run-instances request.
Setting this value is a bit of an art, but we choose the value below
because our image is roughly 10GB in size, and if Eucalyptus doesn’t have
the image cached, it could take half an hour to get our image started.</p>
        
      
        <dt id="PUBLIC_IP_FILE">PUBLIC_IP_FILE
        
        <dd class="description">
        
      
        <dt id="SLEEP_TIME">SLEEP_TIME
        
        <dd class="description">
        
      
        <dt id="TIME_IN_SECONDS">TIME_IN_SECONDS
        
        <dd class="description">
        
      
        <dt id="USE_SSL">USE_SSL
        
        <dd class="description"><p>A constant that indicates that SSL should be used when checking if a given
port is open.</p>
        
      
        <dt id="VER_NUM">VER_NUM
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-get_cert" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_cert</span><span
            class="method-args">(filename)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_cert-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_cert</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>
  })
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_cert-source -->
          
        </div>

        

        
      </div><!-- get_cert-method -->

    
      <div id="method-c-get_cloud_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_cloud_info</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_cloud_info-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 279</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_cloud_info</span>()
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_json_file</span>(<span class="ruby-constant">CLOUD_INFO_FILE</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_cloud_info-source -->
          
        </div>

        

        
      </div><!-- get_cloud_info-method -->

    
      <div id="method-c-get_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_key</span><span
            class="method-args">(filename)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_key-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 248</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_key</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">filename</span>)
  <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>
  })
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_key-source -->
          
        </div>

        

        
      </div><!-- get_key-method -->

    
      <div id="method-c-get_my_public_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_my_public_ip</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_my_public_ip-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 139</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_my_public_ip</span>()
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_file</span>(<span class="ruby-constant">PUBLIC_IP_FILE</span>, <span class="ruby-identifier">chomp</span>=<span class="ruby-keyword">true</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_my_public_ip-source -->
          
        </div>

        

        
      </div><!-- get_my_public_ip-method -->

    
      <div id="method-c-get_random_alphanumeric" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_random_alphanumeric</span><span
            class="method-args">(length=10)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns a random string composed of alphanumeric characters, as long as the
user requests.</p>
          

          
          <div class="method-source-code" id="get_random_alphanumeric-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 126</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_random_alphanumeric</span>(<span class="ruby-identifier">length</span>=<span class="ruby-value">10</span>)
  <span class="ruby-identifier">random</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">possible</span> = <span class="ruby-string">&quot;0123456789abcdefghijklmnopqrstuvxwyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
  <span class="ruby-identifier">possibleLength</span> = <span class="ruby-identifier">possible</span>.<span class="ruby-identifier">length</span>
   
  <span class="ruby-identifier">length</span>.<span class="ruby-identifier">times</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">random</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">possible</span>[<span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">rand</span>(<span class="ruby-identifier">possibleLength</span>)]
  }
   
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">random</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_random_alphanumeric-source -->
          
        </div>

        

        
      </div><!-- get_random_alphanumeric-method -->

    
      <div id="method-c-get_secret" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_secret</span><span
            class="method-args">(filename="/etc/appscale/secret.key")</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_secret-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 255</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_secret</span>(<span class="ruby-identifier">filename</span>=<span class="ruby-string">&quot;/etc/appscale/secret.key&quot;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_file</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">filename</span>), <span class="ruby-identifier">chomp</span>=<span class="ruby-keyword">true</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_secret-source -->
          
        </div>

        

        
      </div><!-- get_secret-method -->

    
      <div id="method-c-is_port_open-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_port_open?</span><span
            class="method-args">(ip, port, use_ssl=DONT_USE_SSL)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="is_port_open-3F-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 160</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_port_open?</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">use_ssl</span>=<span class="ruby-constant">DONT_USE_SSL</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-identifier">timeout</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">sock</span> = <span class="ruby-constant">TCPSocket</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">port</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">use_ssl</span>
          <span class="ruby-identifier">ssl_context</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLContext</span>.<span class="ruby-identifier">new</span>() 
          <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">verify_mode</span> 
            <span class="ruby-identifier">ssl_context</span>.<span class="ruby-identifier">verify_mode</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">VERIFY_NONE</span> 
          <span class="ruby-keyword">end</span> 
          <span class="ruby-identifier">sslsocket</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSLSocket</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sock</span>, <span class="ruby-identifier">ssl_context</span>) 
          <span class="ruby-identifier">sslsocket</span>.<span class="ruby-identifier">sync_close</span> = <span class="ruby-keyword">true</span> 
          <span class="ruby-identifier">sslsocket</span>.<span class="ruby-identifier">connect</span>          
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">sock</span>.<span class="ruby-identifier">close</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNREFUSED</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EHOSTUNREACH</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNRESET</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- is_port_open-3F-source -->
          
        </div>

        

        
      </div><!-- is_port_open-3F-method -->

    
      <div id="method-c-local_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">local_ip</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Code for <a href="HelperFunctions.html#method-c-local_ip">::local_ip</a>
taken from  <a
href="http://coderrr.wordpress.com/2008/05/28/get-your-local-ip-address/">coderrr.wordpress.com/2008/05/28/get-your-local-ip-address/</a></p>
          

          
          <div class="method-source-code" id="local_ip-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 262</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">local_ip</span>
  <span class="ruby-constant">UDPSocket</span>.<span class="ruby-identifier">open</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">connect</span>(<span class="ruby-string">&quot;64.233.187.99&quot;</span>, <span class="ruby-value">1</span>); <span class="ruby-identifier">s</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">last</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- local_ip-source -->
          
        </div>

        

        
      </div><!-- local_ip-method -->

    
      <div id="method-c-read_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">read_file</span><span
            class="method-args">(location, chomp=true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="read_file-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 106</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_file</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">chomp</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">location</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span> }
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">chomp</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">chomp</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">file</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- read_file-source -->
          
        </div>

        

        
      </div><!-- read_file-method -->

    
      <div id="method-c-read_json_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">read_json_file</span><span
            class="method-args">(location)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Reads the given file, which is assumed to be a JSON-loadable object, and
returns that JSON back to the caller.</p>
          

          
          <div class="method-source-code" id="read_json_file-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 118</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_json_file</span>(<span class="ruby-identifier">location</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_file</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">chomp</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- read_json_file-source -->
          
        </div>

        

        
      </div><!-- read_json_file-method -->

    
      <div id="method-c-run_remote_command" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_remote_command</span><span
            class="method-args">(ip, command, public_key_loc, want_output)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="run_remote_command-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 186</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">run_remote_command</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">command</span>, <span class="ruby-identifier">public_key_loc</span>, <span class="ruby-identifier">want_output</span>)
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;ip is [#{ip}], command is [#{command}], public key is [#{public_key_loc}], want output? [#{want_output}]&quot;</span>)
  <span class="ruby-identifier">public_key_loc</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">public_key_loc</span>)
  
  <span class="ruby-identifier">remote_cmd</span> = <span class="ruby-node">&quot;ssh -i #{public_key_loc} -o StrictHostkeyChecking=no root@#{ip} '#{command} &quot;</span>
  
  <span class="ruby-identifier">output_file</span> = <span class="ruby-node">&quot;/tmp/#{ip}.log&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">want_output</span>
    <span class="ruby-identifier">remote_cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;2&gt;&amp;1 &gt; #{output_file} &amp;' &amp;&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">remote_cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&gt; /dev/null &amp;' &amp;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Running [#{remote_cmd}]&quot;</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">want_output</span>
    <span class="ruby-keyword">return</span> <span class="ruby-node">%x#{remote_cmd}`</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">system</span> <span class="ruby-identifier">remote_cmd</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">remote_cmd</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- run_remote_command-source -->
          
        </div>

        

        
      </div><!-- run_remote_command-method -->

    
      <div id="method-c-scp_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">scp_file</span><span
            class="method-args">(local_file_loc, remote_file_loc, target_ip, private_key_loc)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="scp_file-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 209</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">scp_file</span>(<span class="ruby-identifier">local_file_loc</span>, <span class="ruby-identifier">remote_file_loc</span>, <span class="ruby-identifier">target_ip</span>, <span class="ruby-identifier">private_key_loc</span>)
  <span class="ruby-identifier">private_key_loc</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">private_key_loc</span>)
  <span class="ruby-node">%xchmod 0600 #{private_key_loc}`</span>
  <span class="ruby-identifier">local_file_loc</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">local_file_loc</span>)
  <span class="ruby-identifier">retval_file</span> = <span class="ruby-node">&quot;/etc/appscale/retval-#{Kernel.rand()}&quot;</span>
  <span class="ruby-identifier">cmd</span> = <span class="ruby-node">&quot;scp -i #{private_key_loc} -o StrictHostkeyChecking=no 2&gt;&amp;1 #{local_file_loc} root@#{target_ip}:#{remote_file_loc}; echo $? &gt; #{retval_file}&quot;</span>
  <span class="ruby-comment">#Kernel.puts(cmd)</span>
  <span class="ruby-identifier">scp_result</span> = <span class="ruby-node">%x#{cmd}`</span>

  <span class="ruby-identifier">loop</span> {
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">retval_file</span>)
    <span class="ruby-identifier">sleep</span>(<span class="ruby-value">5</span>)
  }

  <span class="ruby-identifier">retval</span> = (<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">retval_file</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span> }).<span class="ruby-identifier">chomp</span>

  <span class="ruby-identifier">fails</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">loop</span> {
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">retval</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;0&quot;</span>
    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;\n\n[#{cmd}] returned #{retval} instead of 0 as expected. Will try to copy again momentarily...&quot;</span>)
    <span class="ruby-identifier">fails</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">abort</span>(<span class="ruby-string">&quot;SCP failed&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">fails</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">5</span>
    <span class="ruby-identifier">sleep</span>(<span class="ruby-value">2</span>)
    <span class="ruby-node">%x#{cmd}`</span>
    <span class="ruby-identifier">retval</span> = (<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">retval_file</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span> }).<span class="ruby-identifier">chomp</span>
  }

  <span class="ruby-comment">#Kernel.puts(scp_result)</span>
  <span class="ruby-node">%xrm -fv #{retval_file}`</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- scp_file-source -->
          
        </div>

        

        
      </div><!-- scp_file-method -->

    
      <div id="method-c-shell" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shell</span><span
            class="method-args">(cmd)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="shell-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 93</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-identifier">cmd</span>)
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-identifier">cmd</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-node">%x#{cmd}`</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- shell-source -->
          
        </div>

        

        
      </div><!-- shell-method -->

    
      <div id="method-c-sleep_until_port_is_open" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sleep_until_port_is_open</span><span
            class="method-args">(ip, port, use_ssl=DONT_USE_SSL)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="sleep_until_port_is_open-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 144</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sleep_until_port_is_open</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">use_ssl</span>=<span class="ruby-constant">DONT_USE_SSL</span>)
  <span class="ruby-identifier">sleep_time</span> = <span class="ruby-value">1</span>

  <span class="ruby-identifier">loop</span> {
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">HelperFunctions</span>.<span class="ruby-identifier">is_port_open?</span>(<span class="ruby-identifier">ip</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">use_ssl</span>)

    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">sleep</span>(<span class="ruby-identifier">sleep_time</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">sleep_time</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">30</span>
      <span class="ruby-identifier">sleep_time</span> <span class="ruby-operator">*=</span> <span class="ruby-value">2</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Waiting on #{ip}:#{port} to be open (currently closed).&quot;</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- sleep_until_port_is_open-source -->
          
        </div>

        

        
      </div><!-- sleep_until_port_is_open-method -->

    
      <div id="method-c-write_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">write_file</span><span
            class="method-args">(location, contents)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="write_file-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">write_file</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">contents</span>)
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">location</span>, <span class="ruby-string">&quot;w+&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">contents</span>) }
<span class="ruby-keyword">end</span></pre>
          </div><!-- write_file-source -->
          
        </div>

        

        
      </div><!-- write_file-method -->

    
      <div id="method-c-write_json_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">write_json_file</span><span
            class="method-args">(location, contents)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="write_json_file-source">
            <pre><span class="ruby-comment"># File Neptune/lib/helperfunctions.rb, line 102</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">write_json_file</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">contents</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">write_file</span>(<span class="ruby-identifier">location</span>, <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-identifier">contents</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- write_json_file-source -->
          
        </div>

        

        
      </div><!-- write_json_file-method -->

    
    </section><!-- public-class-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

